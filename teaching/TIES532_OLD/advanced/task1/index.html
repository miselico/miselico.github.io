
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Advanced task TIES532 - RESTful web services - Michael Cochez</title>
  <meta name="author" content="">

  
  <meta name="description" content=" ">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://www.cochez.nl/teaching/TIES532_OLD/advanced/task1/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="Michael Cochez" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-54043599-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1><a href="/">Michael Cochez</a></h1>
  
    <h2>Assistant Professor at Vrije Universiteit Amsterdam</h2>
  
</hgroup>

</header>
  <nav role="navigation"><!--
<ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
-->
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/research/">Research</a></li>
  <li><a href="/teaching/">Teaching</a></li>  
  <li><a href="/software/">Software</a></li>
  <li><a href="/contact/">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Advanced task TIES532 - RESTful web services</h1>
    
  </header>
  
  <h2 id="goal">Goal</h2>
<p>Learn more about RESTful APIs and how to use them. In this exercise the student needs to interact with two slightly similar APIs. 
This task also requires the HTTP POST method to upload files to a server. In order to be more memory efficient, streams need to be used. 
Further, multi-threading needs to be used in an attempts to speed up the copying process.
This task is performed individually.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>The student must understand the exercises from TIES456, 
i.e. the student should be able to  implement the basic exercises and understands the workings.
HTTP post messages with multiple parts use MIME for encoding of the parts. Read about MIME on <a href="http://en.wikipedia.org/wiki/MIME">http://en.wikipedia.org/wiki/MIME</a> especially about multipart messages.
For this task, you can use any programming language <strong>except Java</strong>.
So, for the language of your choice, you will have to find out how to call services and serve requests.
If you have no experience with multi-threading in that language, find out how it can be done.
Some programming languages are inherently single threaded, please document if this is the case.</p>

<h2 id="task">Task</h2>
<p>The goal of this task is to create a service which is able to back-up the user’s files from the mediafire service (<a href="http://www.mediafire.com/">http://www.mediafire.com/</a>) 
to the sendspace service (<a href="http://www.sendspace.com">http://www.sendspace.com</a>). 
The student’s service only has to work in that direction and not the other way around because the sendspace service requires a paid subscription to be able to implement the service in the other direction. 
Your service is accessed through a (simple) website where the user’s credentials for both services can be provided and the process can be started. The user has to be informed about completion or failure of the process.
Your service can be hosted on Heroku, AWS or another service of your liking.</p>

<p>The process should connect to both services and check which files and folders from the mediafire service are missing on the sendspace service. 
If a file is missing on sendspace, the file needs to be downloaded from mediafire and uploaded to sendspace in the right directory. 
Note that the file has to pass trough your server for this exercise (there are some options to avoid this, which would be a better idea. However, for the sake of this exercise you have to do it this way.).
The process should search recursively in all directories. Comparing two files can be done by only using the file’s name. 
(Thus, if sendspace has a file with the same name in the same location, the file can does not have to be copied.) 
The actual copying (downloading/uploading) should be done in parallel.</p>

<p>The API descriptions can be found on the <a href="http://developers.mediafire.com/index.php/REST_API">mediafire developers site</a> and the <a href="http://www.sendspace.com/dev_method.html">sendspace equivalent</a>.</p>

<p>Do not to buffer too much data. Use streams wherever reasonable. Especially while downloading whole files from the one service and writing them to the other one.</p>

<p>The final delivered task are 2 projects, programmed using the language of your choice (except Java).
Try to follow a multi-tier architecture. The first project/package/namespace contains the classes (and libraries) used to communicate with the above mentioned services. 
This is the logic tier. The second project which contains the web site code, which is the presentation tier. 
Note that the mediafire and sendspace services function as the data tier of your service. See also <a href="http://en.wikipedia.org/wiki/Multitier_architecture">http://en.wikipedia.org/wiki/Multitier_architecture</a>.</p>

<h3 id="returning-the-task">Returning the task###</h3>
<ul>
  <li>Both projects need to be pushed to a separate git repository.</li>
  <li>Add the teacher (user name:miselico) as a collaborator to the repos.</li>
  <li>Add a README.md file to the root of your repo in which you document your choices and the author name.</li>
  <li>You need to arrange a meeting with the teacher to show the task.</li>
</ul>

<h2 id="hints">Hints</h2>
<ol>
  <li>Do not use esoteric languages if you don’t want to handle their troubles. (think: finding help, googling errors, deploying, …)</li>
  <li>Make sure that your mediafire read and sendspace write methods are thread safe! This can be done by synchronizing correctly or avoiding concurrent access altogether. The latter one is most often easier to implement.</li>
  <li>You can assume that the user does not have duplicate file names in the directories. (Or just ignore them if they are there)</li>
  <li>Think about how you design the class structure. Do not put all the code inside one class/method. (you could consider having classes/interfaces like MediaFire, SendSpace, WebFolder, WebFile, …)</li>
  <li>You are free to use libraries as you see fit. Use the dependency management tool suitable for the language you choose.</li>
  <li>Error checking should be implemented up till a reasonable extend. (Check HTTP status codes and API return values.) When an error is found, you do not have to write extensive handling of the error. (No retry, no alternative strategies, etc…) 
Just show an error message to the user. Do not let the whole application die when a <em>normal</em> exception is thrown though.</li>
</ol>

<!--

OLD: Java specific
1. Look at the Hints section of the basic exercise. Except for remarks about thread safety, all of them are still valid.
2. You can check whether all jobs submitted to the thread pool are finished by using a [CountDownLatch](http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html) 
or other helper classes from [java.util.concurrent](http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/package-summary.html).
3. Make sure that your mediafire read and sendspace write methods are thread safe! This can be done by synchronizing correctly or avoiding concurrent access altogether. The latter one is most often easier to implement.
4. You can assume that the user does not have duplicate file names in the directories. (Or just ignore them if they are there)
5. Think about how you design the class structure. Do not put all the code inside one class/method. (you could consider having classes/interfaces like MediaFire, SendSpace, WebFolder, WebFile, …)
6. Perhaps the most difficult part of this task is the file transfer. The main difficulty is that the sendspace service expects you to set the Content-length header, i.e. specify the length of the transmission in the HTTP request. 
Combined with the fact that you need to use streams, several things have to be kept in mind.
    1. You cannot use the fluent API of the http client libraries for the retrieval /sending <code><span style="text-decoration:line-through">Content c = Request.Get(uri).execute().returnContent() </span></code> 
    The reason is that this way you will not be able to get the length of the file before you download it completely, while you need it before you can start uploading.
    2.  You can get the content length of the HttpResponse object by
    <code><pre>
    Header[] contentLengthHeaders = response.getHeaders("Content-length");
    final long length = Long.parseLong(contentLengthHeaders[0].getValue());
    </pre></code>
    Of course you should first check whether the header exists, and throw an exception if it is not set.Another download related issue is that you can only perform
    <code><pre>
    EntityUtils.consume(entity);
    httpGet.releaseConnection();
    </pre></code>
    After uploading the whole file to the other service.
    3.  When looking at the upload API of Sendspace, you will notice that they show an HTML form for the upload. What you now have to do is mimic a form submission in your own code, including all the fields which would be filled in the browser. 
    This can be done using a MultiPartEntity, where textual values are added by
    <code><pre>entity.addPart("string_field",new StringBody("field value"));</pre></code> 
    Files (streams) can be added in a similar way by using an InputStreamBody. There is however still the complication of having to specify the size properly. 
    To solve this issue, read [this blog post](http://radomirml.com/2009/02/13/file-upload-with-httpcomponents-successor-of-commons-httpclient). In the case described in the blog post the size is known because of the in memory byte buffer. 
    In this exercise the size is known from the Content-length header during the download.
    The response which comes back from the upload call is not XML nor JSON. It is just a text file. You can assume that everything went alright if the response starts with *"upload_status=ok"*.
    Disable the feature of sending an e-mail to the user for every newly created file on sendspace. This can be done by setting *“notify_uploader”* to “0” as in
    <code><pre>entity.addPart("notify_uploader",new StringBody("0"));</pre></code> 
7. Using thread pools, you can opt for the fixed thread pool.
<code><pre>ExecutorService exec = Executors.newFixedThreadPool(10);</pre></code>
You will however notice that this threadpool does not stop working when your application stops because the threads in the pool are still “actively waiting” (they are blocked).
You should only create one (static) threadpool for your application. In that case there will be a fixed overhead of 10 blocked threads which is not a big problem. When your application is ran on a server, it will not need to stop on its own anyway.
If you want to create a pool which stops working when all other threads in the application have finished their jobs, you can look at the MoreExecutors class of the google guava library.
Obviously you can devise a different strategy for managing the threads.
8. You are free to use libraries as you see fit. When not using Maven, all used libraries must be inside the project and pushed to the git repository.
9. Error checking should be implemented up till a reasonable extend. (Check HTTP status codes and API return values.) When an error is found, you do not have to write extensive handling of the error. (No retry, no alternative strategies, etc...) 
Just show an error message to the user. Do not let the whole application die when a *normal* exception is thrown though.

-->

  
    <footer>
      
      
        <div class="sharing">
  
  
  
</div>

      
    </footer>
  
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - Michael Cochez -
  <span class="credit">Powered by Jekyll. Derived from Octopress.</span>
</p>

</footer>
  











</body>
</html>
